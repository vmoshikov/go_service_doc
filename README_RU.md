# Генератор документации для Go сервисов

Python-сервис, который автоматически генерирует комплексную документацию для Go сервисов, анализируя кодовую базу и объединяя пользовательские разделы с автоматически сгенерированным контентом.

## Возможности

- **Автоматический анализ кода**: Парсит исходные файлы Go для извлечения:
  - Определений функций с сигнатурами и комментариями
  - gRPC и REST API эндпоинтов
  - Тестовых функций и тест-кейсов
  - Зависимостей из `go.mod`

- **Разделы документации**:
  - **Архитектура** (`user_architecture.md`) - Предоставляется пользователем
  - **Структура БД** (`user_db_structure.md`) - Предоставляется пользователем (опционально)
  - **Функции** (`functions.md`) - Автоматически генерируется
  - **Спецификация API** (`api.md`) - Автоматически генерируется с JSON представлениями
  - **Тестирование** (`test.md`) - Автоматически генерируется
  - **Используемые библиотеки** (`libraries.md`) - Автоматически генерируется
  - **Прочее** - Предоставляется пользователем (опционально)

- **Документация API**: Извлекает gRPC и REST эндпоинты с:
  - Комментариями над описаниями серверов
  - Входными и выходными параметрами
  - JSON представлениями структур запросов/ответов

- **Диаграммы PlantUML**: Автоматически генерирует диаграммы архитектуры:
  - Графы зависимостей компонентов
  - Представления слоистой архитектуры
  - Визуальное представление структуры сервиса

## Установка

Установите зависимости:

```bash
pip install -r requirements.txt
```

Сервис использует **tree-sitter** для точного парсинга на основе AST кода Go, что обеспечивает лучшую точность, чем парсинг на основе регулярных выражений. Если tree-sitter недоступен, сервис автоматически переключится на парсинг с помощью регулярных выражений.

### Зависимости

- `tree-sitter>=0.20.0` - Библиотека парсера
- `tree-sitter-go>=0.19.0` - Грамматика языка Go для tree-sitter

## Использование

### Локальная установка

```bash
python doc_generator.py <путь_к_директории_go_сервиса> [--output README.md]
```

### Docker

Соберите Docker образ:

```bash
docker build -t go-doc-generator .
```

#### Запуск как сервис (Рекомендуется)

Запустите контейнер сервиса (остается запущенным для доступа через exec):

```bash
docker run -d --name doc-gen -v /path/to/go-service:/workspace go-doc-generator
```

Выполните команды в запущенном контейнере:

```bash
# Генерация документации
docker exec -it doc-gen doc_generator.py /workspace

# С пользовательским именем файла
docker exec -it doc-gen doc_generator.py /workspace --output CUSTOM_README.md

# Доступ к shell для исследования
docker exec -it doc-gen bash

# Просмотр файлов в workspace
docker exec -it doc-gen ls -la /workspace
```

Остановите и удалите контейнер:

```bash
docker stop doc-gen && docker rm doc-gen
```

#### Одноразовый запуск (Выполнение и выход)

```bash
docker run --rm -v /path/to/go-service:/workspace go-doc-generator /workspace
```

#### Использование Docker Compose

```bash
# Запуск сервиса
docker-compose up -d

# Выполнение генератора
docker-compose exec doc-generator doc_generator.py /workspace

# Доступ к shell
docker-compose exec doc-generator bash

# Остановка сервиса
docker-compose down
```

### Пример

```bash
# Локально
python doc_generator.py /path/to/my-go-service

# Docker
docker run --rm -v /path/to/my-go-service:/workspace go-doc-generator /workspace
```

Это выполнит:
1. Анализ кодовой базы Go сервиса
2. Генерацию разделов документации в директории `docs/`
3. Объединение всех разделов в `README.md` в корне сервиса

## Пользовательская документация

Вы можете добавить свои собственные разделы документации, которые будут автоматически включены в сгенерированный README.md.

### Предопределенные разделы

Поместите эти файлы в директорию `docs/` для специальной обработки:

- **`user_architecture.md`** - Обзор архитектуры сервиса (появляется первым)
- **`user_db_structure.md`** - Схема и структура базы данных (появляется вторым, опционально)

### Пользовательские разделы

Любые другие `.md` файлы в директории `docs/` будут автоматически включены в раздел "Прочее":

- `deployment.md` - Инструкции по развертыванию
- `api_examples.md` - Примеры использования API
- `troubleshooting.md` - Руководство по устранению неполадок
- Любые другие markdown файлы, которые вы создадите

### Как добавить разделы

1. Создайте markdown файл в директории `docs/`
2. Начните с заголовка `# Заголовок`
3. Запустите генератор документации
4. Ваш раздел появится в README.md

**Пример:**

```markdown
# Руководство по развертыванию

## Требования
- Docker
- Kubernetes

## Шаги
1. Собрать образ
2. Развернуть
```

См. [USER_SECTIONS.md](USER_SECTIONS.md) для подробных инструкций и примеров.

## Генерируемая документация

Сервис автоматически генерирует:

- **functions.md**: Все определения функций с сигнатурами и комментариями
- **api.md**: Полная спецификация API с эндпоинтами, параметрами и JSON схемами
- **test.md**: Тестовые функции, бенчмарки и примеры
- **libraries.md**: Зависимости из `go.mod`

Все разделы автоматически объединяются в один файл `README.md`.

## Поддерживаемые фреймворки

- **gRPC**: Методы сервисов, сгенерированные из proto
- **REST**: Gin, Echo, net/http, Gorilla Mux

## Структура

```
go_service_doc/
├── doc_generator.py          # Главная точка входа
├── parsers/                  # Парсеры кода
│   ├── function_parser.py
│   ├── api_parser.py
│   ├── test_parser.py
│   └── library_parser.py
├── generators/              # Генераторы документации
│   └── doc_generator.py
└── requirements.txt
```

## Генерация CHANGELOG

Сервис включает автоматический генератор CHANGELOG, следующий формату [keepachangelog.com](https://keepachangelog.com/):

```bash
python changelog_generator.py <путь_к_go_сервису> [--version 1.0.0] [--since v0.9.0]
```

### Возможности

- **Интеграция с Git**: Анализирует коммиты и изменения в git
- **Анализ Tree-sitter**: Понимает изменения в коде (функции, API и т.д.)
- **На основе AI**: Генерирует записи changelog с использованием AI
- **Формат Keep a Changelog**: Следует стандартному формату с разделами Added/Changed/Deprecated/Removed/Fixed/Security
- **Автоматическое версионирование**: Автоматически увеличивает версию из git тегов

### Использование

```bash
# Генерация changelog для всех коммитов с последнего тега
python changelog_generator.py /path/to/go-service

# Генерация changelog с указанной версией
python changelog_generator.py /path/to/go-service --version 1.2.0

# Генерация changelog с определенного тега/коммита
python changelog_generator.py /path/to/go-service --since v1.0.0
```

## Примечания

- Сервис использует **tree-sitter** для точного парсинга на основе AST, обеспечивая лучшую обработку:
  - Сложных сигнатур функций
  - Определений структур со встроенными типами
  - Комментариев и документации
  - Краевых случаев в синтаксисе Go
  
- Если tree-sitter не установлен, сервис автоматически переключается на парсинг с помощью регулярных выражений
- Сервис пропускает директории `vendor/` и тестовые файлы при парсинге
- Определения структур парсятся для генерации JSON представлений в документации API
- Комментарии над функциями и эндпоинтами сохраняются в документации
